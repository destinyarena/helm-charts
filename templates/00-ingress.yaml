apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: {{ .Values.ingress.name }}
  annotations:
    kubernetes.io/ingress.class: "nginx"
    {{- if .Values.tls.enabled }}
    cert-manager.io/cluster-issuer: "letsencrypt"
    {{- end }}
    nginx.ingress.kubernetes.io/server-snippet: |
        real_ip_header CF-Connecting-IP;
spec:
  {{- with .Values.ingress }}
  rules:
    - http:
        paths:
          {{- range .paths }}
          - path: {{ .path }}
            backend:
              serviceName: {{  .service }}
              servicePort: {{  .port }}
          {{- end }}
      {{- if .host }}
      host: {{ .host }}
      {{- end }}
  {{- end }}
  {{- if .Values.tls.enabled }}
  tls:
    - hosts:
        - destinyarena.app
      secretName: destinyarena-tls
  {{- end }}
